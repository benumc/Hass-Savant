<?xml version="1.0" encoding="UTF-8"?>
<component xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="racepoint_component_profile.xsd" manufacturer="Home" model="Assistant" alias="Home Assistant" device_class="Lighting_controller" rpm_xml_version="1.9" minimum_component_engine_version="9.2">
   <notes />
   <component_properties />
   <control_interfaces preferred="ip">
      <ip port="8123" response_time_length_ms="500" reconnect_timeout_ms="10" protocol="http">
         <http_header name="Authorization">Bearer TOKEN</http_header>
      </ip>
   </control_interfaces>
   <media_interfaces>
      <data name_on_component="ETHERNET">
         <combined_media>
            <data_media type="ethernet" />
            <control port="8123" />
         </combined_media>
      </data>
      <internal name_on_component="Lighting Controller">
         <environmental_media />
         <resource resource_type="ENV_LIGHTINGCONTROLLER_SOURCE" />
         <resource resource_type="ENV_FANCONTROLLER_SOURCE" />
      </internal>
   </media_interfaces>
   <state_variable_list>
      <state_variable name="FanSet_0" owning_logical_component="Home Assistant" user_editable="yes" note="Fan Speed Off">0</state_variable>
      <state_variable name="FanSet_1" owning_logical_component="Home Assistant" user_editable="yes" note="Fan Speed Low">2</state_variable>
      <state_variable name="FanSet_2" owning_logical_component="Home Assistant" user_editable="yes" note="Fan Speed Mid">4</state_variable>
      <state_variable name="FanSet_3" owning_logical_component="Home Assistant" user_editable="yes" note="Fan Speed High">7</state_variable>
   </state_variable_list>
   <logical_component logical_component_name="Home Assistant">
      <implementation>
         <internal name_on_component="Lighting Controller" />
      </implementation>
      <resource_component_actions resource_type="ENV_FANCONTROLLER_SOURCE">
         <action name="FanSet">
            <action_argument name="Address1" note="Entity ID" />
            <action_argument name="Address2" note="not used" />
            <action_argument name="Address3" note="not used" />
            <action_argument name="Address4" note="not used" />
            <action_argument name="Address5" note="not used" />
            <action_argument name="Address6" note="not used" />
            <action_argument name="FanSpeed" note="Fan Speed 0 - 3" />
            <command_interface interface="ip">
               <command response_required="no">
                  <command_string http_request_type="POST" type="character">api/services/fan/turn_on</command_string>
                  <http_header name="Content-Type">application/json</http_header>
                  <parameter_list>
                     <parameter parameter_data_type="character" isHttpBody="true">{"entity_id": "</parameter>
                     <parameter parameter_data_type="character" isHttpBody="true" action_argument="Address1" />
                     <parameter parameter_data_type="character" isHttpBody="true">", "speed": "</parameter>
                     <parameter parameter_data_type="character" isHttpBody="true" state_variable="FanSet_*" wildcard_source="action_argument" wildcard_source_name="FanSpeed" />
                     <parameter parameter_data_type="character" isHttpBody="true">"}</parameter>
                  </parameter_list>
                  <delay ms_delay="500" />
               </command>
            </command_interface>
         </action>
         <entity name="Fan" address_components="2">
            <slider_representation>
               <press_action name="FanSet" />
               <valueSource name="CurrentDimmerLevel">
                  <unique_identifier name="Needed" address_component="2" />
                  <unique_identifier name="DeviceID" address_component="1" />
               </valueSource>
            </slider_representation>
            <query_status_with_action name="QueryFanState" period_ms="10000">
               <with_arg name="Address1" address_component="1" format="%s" />
            </query_status_with_action>
         </entity>
      </resource_component_actions>
      <resource_component_actions resource_type="ENV_LIGHTINGCONTROLLER_SOURCE">
         <action name="SwitchOn">
            <action_argument name="Address1" note="" />
            <action_argument name="Address2" note="" />
            <action_argument name="Address3" note="" />
            <action_argument name="Address4" note="" />
            <action_argument name="Address5" note="" />
            <action_argument name="Address6" note="" />
            <command_interface interface="ip">
               <command response_required="yes">
                  <command_string http_request_type="POST" type="character">api/services/light/turn_on</command_string>
                  <http_header name="Content-Type">application/json</http_header>
                  <parameter_list>
                     <parameter parameter_data_type="character" isHttpBody="true">{"entity_id": "</parameter>
                     <parameter parameter_data_type="character" isHttpBody="true" action_argument="Address1" />
                     <parameter parameter_data_type="character" isHttpBody="true">"}</parameter>
                  </parameter_list>
                  <response_codes>
                     <rspmessage status="success" name="brightnessSet">
                        <constant type="character">200</constant>
                        <constant type="character">[{"success":{"/lights/</constant>
                        <data type="character" terminator_type="character" terminator="/">
                           <update state="CurrentLightNumber" type="integer" />
                        </data>
                        <constant type="character">state/on":</constant>
                        <data type="character" terminator_type="character" terminator="}}]">
                           <data_map match_required="yes">
                              <map key="true">
                                 <update state="LightPowerStatus" type="string">ON</update>
                                 <update state="isLightOn" type="boolean">true</update>
                              </map>
                              <map key="false">
                                 <update state="LightPowerStatus" type="string">OFF</update>
                                 <update state="isLightOn" type="boolean">false</update>
                              </map>
                           </data_map>
                        </data>
                        <append_data_to_state_names state="CurrentLightNumber" />
                     </rspmessage>
                  </response_codes>
                  <delay ms_delay="10" />
               </command>
            </command_interface>
         </action>
         <action name="SwitchOff">
            <action_argument name="Address1" note="" />
            <action_argument name="Address2" note="" />
            <action_argument name="Address3" note="" />
            <action_argument name="Address4" note="" />
            <action_argument name="Address5" note="" />
            <action_argument name="Address6" note="" />
            <command_interface interface="ip">
               <command response_required="yes">
                  <command_string http_request_type="POST" type="character">api/services/light/turn_off</command_string>
                  <http_header name="Content-Type">application/json</http_header>
                  <parameter_list>
                     <parameter parameter_data_type="character" isHttpBody="true">{"entity_id": "</parameter>
                     <parameter parameter_data_type="character" isHttpBody="true" action_argument="Address1" />
                     <parameter parameter_data_type="character" isHttpBody="true">"}</parameter>
                  </parameter_list>
                  <response_codes>
                     <rspmessage status="success" name="brightnessSet">
                        <constant type="character">200</constant>
                        <constant type="character">[{"success":{"/lights/</constant>
                        <data type="character" terminator_type="character" terminator="/">
                           <update state="CurrentLightNumber" type="integer" />
                        </data>
                        <constant type="character">state/on":</constant>
                        <data type="character" terminator_type="character" terminator="}}]">
                           <data_map match_required="yes">
                              <map key="true">
                                 <update state="LightPowerStatus" type="string">ON</update>
                                 <update state="isLightOn" type="boolean">true</update>
                              </map>
                              <map key="false">
                                 <update state="LightPowerStatus" type="string">OFF</update>
                                 <update state="isLightOn" type="boolean">false</update>
                                 <update state="DT_GroupBrightness" type="integer">0</update>
                              </map>
                           </data_map>
                        </data>
                        <append_data_to_state_names state="CurrentLightNumber" />
                     </rspmessage>
                  </response_codes>
                  <delay ms_delay="10" />
               </command>
            </command_interface>
         </action>
         <entity name="Switch" address_components="1">
            <toggle_button_representation>
               <release_action name="SwitchOn" />
               <toggle_release_action name="SwitchOff" />
               <osd_press_action name="SwitchOn" />
               <osd_hold_action name="SwitchOff" />
               <toggleOnUsingState name="isLightOn">
                  <unique_identifier name="CurrentLightNumber" address_component="1" />
               </toggleOnUsingState>
            </toggle_button_representation>
            <query_status_with_action name="QueryLightState" period_ms="10000">
               <with_arg name="Address1" address_component="1" format="%s" />
            </query_status_with_action>
            <query_status_with_action name="UpdateIfLightIsOn" period_ms="60000">
               <with_arg name="Address1" address_component="1" format="%d" />
            </query_status_with_action>
            <query_status_with_action name="UpdateIfLightIsOff" period_ms="60000">
               <with_arg name="Address1" address_component="1" format="%d" />
            </query_status_with_action>
         </entity>
      </resource_component_actions>
      <custom_component_actions>
         <action name="QueryLightState">
            <action_argument name="Address1" note="Entity ID" />
            <action_argument name="Address2" note="not used" />
            <action_argument name="Address3" note="not used" />
            <action_argument name="Address4" note="not used" />
            <action_argument name="Address5" note="not used" />
            <action_argument name="Address6" note="not used" />
            <update_state_variable name="CurrentLightNumber" update_type="set" update_source="action_argument">Address1</update_state_variable>
            <command_interface interface="ip">
               <command response_required="yes">
                  <http_header name="Content-Type">application/json</http_header>
                  <command_string http_request_type="GET" type="character">api/states/</command_string>
                  <parameter_list>
                     <parameter parameter_data_type="character" isHttpBody="false" action_argument="Address1" />
                  </parameter_list>
                  <response_codes>
                     <rspmessage status="success" name="HassLightOn">
                        <constant type="character">200</constant>
                        <root_object name="none" matches_required="at_least_one" format="json">
                           <values path="//state" matches_required="at_least_one">
                              <value_map match_required="yes">
                                 <map key="off">
                                    <update state="LightPowerStatus" type="string">OFF</update>
                                    <update state="isLightOn" type="boolean">false</update>
                                 </map>
                                 <map key="on">
                                    <update state="LightPowerStatus" type="string">ON</update>
                                    <update state="isLightOn" type="boolean">true</update>
                                 </map>
                              </value_map>
                           </values>
                        </root_object>
                        <append_data_to_state_names state="CurrentLightNumber" />
                     </rspmessage>
                  </response_codes>
                  <delay ms_delay="50" />
               </command>
            </command_interface>
         </action>
         <action name="QueryFanState">
            <action_argument name="Address1" note="Entity ID" />
            <action_argument name="Address2" note="not used" />
            <action_argument name="Address3" note="not used" />
            <action_argument name="Address4" note="not used" />
            <action_argument name="Address5" note="not used" />
            <action_argument name="Address6" note="not used" />
            <update_state_variable name="CurrentLightNumber" update_type="set" update_source="action_argument">Address1</update_state_variable>
            <command_interface interface="ip">
               <command response_required="yes">
                  <http_header name="Content-Type">application/json</http_header>
                  <command_string http_request_type="GET" type="character">api/states/</command_string>
                  <parameter_list>
                     <parameter parameter_data_type="character" isHttpBody="false" action_argument="Address1" />
                  </parameter_list>
                  <response_codes>
                     <rspmessage status="success" name="HassLightOn">
                        <constant type="character">200</constant>
                        <root_object name="none" matches_required="at_least_one" format="json">
                           <values path="//state" matches_required="at_least_one">
                              <value_map match_required="yes">
                                 <map key="off">
                                    <update state="LightPowerStatus" type="string">OFF</update>
                                    <update state="isLightOn" type="boolean">false</update>
                                 </map>
                                 <map key="on">
                                    <update state="LightPowerStatus" type="string">ON</update>
                                    <update state="isLightOn" type="boolean">true</update>
                                 </map>
                              </value_map>
                           </values>
                        </root_object>
                        <append_data_to_state_names state="CurrentLightNumber" />
                     </rspmessage>
                  </response_codes>
                  <delay ms_delay="50" />
               </command>
            </command_interface>
         </action>
      </custom_component_actions>
   </logical_component>
</component>
